<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
   
    <style type="text/css">
        html { height: 100% }
        body { height: 100%; margin: 0px; padding: 0px }
        #map_canvas { height: 100% }
    </style>
   
    <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script>
   
    <!-- jQuery -->
    <script type="text/javascript" src="http://kensairyce.bol.ucla.edu/jquery-1.5.2.min.js"></script>

    <script type="text/javascript">    
        //declare namespace
        var clustering = {};
       
        //declare map
        var map;
       
        var flickr = [];
        var clusters = [];

        //defines bounding box of all locations
        var bounds;
       
        //info window
        var infowindow = new google.maps.InfoWindow();
       
        //trace function for debugging
        function trace(message)
        {
            if (typeof console != 'undefined')
            {
                console.log(message);
            }
        }
       
        //toggle array layers on/off
        clustering.toggleArrayLayer = function(arraylayer)
        {
            if (arraylayer) {
                for (i in arraylayer) {                
                    if (arraylayer[i].getVisible() == true)
                    {
                        arraylayer[i].setMap(null);
                        arraylayer[i].visible = false;
                    }
                    else
                    {
                        arraylayer[i].setMap(map);
                        arraylayer[i].visible = true;
                    }
                }
            }
        }
       
        //Function to create Flickr Marker
        clustering.createFlickrMarker = function(i,latitude,longitude,infowindowcontent,icon)
        {
            var markerLatLng = new google.maps.LatLng(latitude,longitude);  
            //extent bounds for each stop and adjust map to fit to it
            bounds.extend(markerLatLng);
            map.fitBounds(bounds);
           
            //set marker to be the flickr image, resizing it to 32 by 32 pixels
            //var image = new google.maps.MarkerImage(icon, null, null, null, new google.maps.Size(32,32));
           
            //create and map the marker
            flickr[i] = new google.maps.Marker({
                position: markerLatLng,
                map: map,
                title: infowindowcontent,
                icon: "http://maps.google.com/mapfiles/marker.png"
            });
           
            //add an onclick event
           /* google.maps.event.addListener(flickr[i], 'click', function() {
                infowindow.setContent(infowindowcontent);
                infowindow.open(map,flickr[i]);
            });*/
        }

                //Function to create Flickr Marker
        clustering.createFlickrCircle = function(i,latitude,longitude,infowindowcontent,icon)
        {
            var markerLatLng = new google.maps.LatLng(latitude,longitude);  
            //extent bounds for each stop and adjust map to fit to it
            bounds.extend(markerLatLng);
            map.fitBounds(bounds);
           
            //set marker to be the flickr image, resizing it to 32 by 32 pixels
            //var image = new google.maps.MarkerImage(icon, null, null, null, new google.maps.Size(32,32));
           
            //create and map the marker
            clusters[i] = new google.maps.Circle({
                position: markerLatLng,
                map: map,
                title: infowindowcontent,
                icon: "http://maps.google.com/mapfiles/marker.png"
            });
           
            //add an onclick event
           /* google.maps.event.addListener(flickr[i], 'click', function() {
                infowindow.setContent(infowindowcontent);
                infowindow.open(map,flickr[i]);
            });*/
        }
               
        //Function to get data from Flickr
        clustering.getFlickr = function(search)
        {
            bounds = new google.maps.LatLngBounds ();
            $.getJSON("/mapPoint", function(data){  
                    $.each(data, function(i, s) {
                        clustering.createFlickrCircle(s[0][0]  , s[0][1][0], s[0][1]|[1] ) //cluster name, lat, long
                            s[1].each(point, function(j, r) {
                                clustering.createFlickrMarker(j,r[0], r[1], null, null)
                                
                            })
                    })
                })
        }
                       
        //Function that gets run when the document loads
        clustering.initialize = function()
        {
            var latlng = new google.maps.LatLng(45.759,4.8366);
            var myOptions = {
                zoom: 12,
                center: latlng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            map = new google.maps.Map(document.getElementById("map_canvas"), myOptions);
           
            //Sample call for yelp data for cafe's
            clustering.getFlickr('bus');
        }
    </script>
</head>

<body onload="clustering.initialize()">
    <!-- side panel div container -->
    <div style="position:absolute; width:380px; height: 100%; overflow:auto; float:left; padding-left:10px; padding-right:10px;">
        <h1>Flickr API</h1>
        <input type="checkbox" id="toggleFlickr" onClick="clustering.toggleArrayLayer(flickr)" checked> flickr layer
    </div>
    <!-- map div container -->

    <div id="map_canvas" style="height:100%; margin-left:400px;"></div>
</body>
</html>